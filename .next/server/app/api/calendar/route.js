"use strict";(()=>{var e={};e.id=913,e.ids=[913],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},85158:e=>{e.exports=require("http2")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},72254:e=>{e.exports=require("node:buffer")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},22312:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>m});var o=r(49303),s=r(88716),i=r(60670),n=r(45609),d=r(90455),l=r(87070),c=r(72897);async function p(e,t,r={}){if(!t)throw Error("Access token not found. Please authenticate with Clio.");let a=process.env.NEXTAUTH_URL||"http://localhost:3000",o=`${a}/api/clio`,s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,method:r.method||"GET",body:r.body?JSON.parse(r.body):void 0,accessToken:t})});if(!s.ok){let e=await s.json();throw Error(`API request failed: ${e.details?.error?.message||"Unknown error"}`)}return s.json()}async function u(e,t,r){return p(`calendar_entries.json?start_date=${t}&end_date=${r}&fields=id,start_at,end_at,summary,description,location{name},attendees{name},calendar_entry_event_type{name}`,e)}async function m(e){let t=await (0,n.getServerSession)(d.L);if(!t)return l.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),a=r.get("startDate"),o=r.get("endDate"),s=e.headers.get("X-Clio-Token");if(!a||!o)return l.NextResponse.json({error:"startDate and endDate are required"},{status:400});try{let e=[];if(t.accessToken)try{let r=await (0,c.y)(t.accessToken,a,o);e=e.concat(r)}catch(e){console.error("Error fetching Google Calendar data:",e)}if(s)try{let t=(await u(s,a,o)).data.map(e=>({id:e.id,time:e.start_at,title:e.summary,type:e.calendar_entry_event_type?.name||null,date:new Date(e.start_at).toISOString().slice(0,10),description:e.description||"No description provided.",location:e.location||"No location specified.",attendees:e.attendees?.map(e=>e.name)||[],source:"calendar",dateTime:new Date(e.start_at)}));e=e.concat(t)}catch(e){console.error("Error fetching Clio Calendar data:",e)}return e.sort((e,t)=>e.dateTime.getTime()-t.dateTime.getTime()),l.NextResponse.json(e)}catch(e){return console.error("Error fetching calendar data:",e),l.NextResponse.json({error:"Failed to fetch calendar data",details:e.message},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/calendar/route",pathname:"/api/calendar",filename:"route",bundlePath:"app/api/calendar/route"},resolvedPagePath:"C:\\Users\\HrishikeshDeshpande\\Documents\\clio\\legal-ai-assistant\\app\\api\\calendar\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:x}=h,y="/api/calendar/route";function w(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}},90455:(e,t,r)=>{r.d(t,{L:()=>a});let a={providers:[(0,r(77234).Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,authorization:{params:{scope:"openid email profile https://www.googleapis.com/auth/calendar.readonly https://www.googleapis.com/auth/gmail.readonly https://www.googleapis.com/auth/gmail.modify https://www.googleapis.com/auth/tasks.readonly",prompt:"select_account"}}}),{id:"clio",name:"Clio",type:"oauth",version:"2.0",token:"https://app.clio.com/oauth/token",authorization:{url:"https://app.clio.com/oauth/authorize",params:{scope:"user:read calendar_entries:read"}},userinfo:"https://app.clio.com/api/v4/users/who_am_i",clientId:"LxULyW60NK6ACMJKx4euWYv7UHVDVXD7gzutljY7",clientSecret:process.env.CLIO_CLIENT_SECRET,profile:e=>({id:e.data.id,name:e.data.name,email:e.data.email})}],secret:process.env.NEXTAUTH_SECRET,callbacks:{jwt:async({token:e,account:t,profile:r})=>(t&&("google"===t.provider&&(e.accessToken=t.access_token),"clio"===t.provider&&(e.clioAccessToken=t.access_token,e.clioRefreshToken=t.refresh_token)),e),session:async({session:e,token:t})=>(e.accessToken=t.accessToken,e.clioAccessToken=t.clioAccessToken,e.clioRefreshToken=t.clioRefreshToken,e)}}},72897:(e,t,r)=>{r.d(t,{G:()=>s,y:()=>o});var a=r(97816);async function o(e,t,r){let o=new a.lkr.auth.OAuth2;o.setCredentials({access_token:e});let s=a.lkr.calendar({version:"v3",auth:o}),i=a.lkr.tasks({version:"v1",auth:o});try{let e=await s.events.list({calendarId:"primary",timeMin:new Date(t).toISOString(),timeMax:new Date(r).toISOString(),singleEvents:!0,orderBy:"startTime"}),a=e.data.items?.map(e=>({id:e.id,time:e.start.dateTime,title:e.summary,type:e.attendees?"Meeting":"Event",date:new Date(e.start.dateTime||e.start.date).toISOString().slice(0,10),description:e.description||"No description provided.",location:e.location||"No location specified.",hangoutLink:e.hangoutLink,attendees:e.attendees?.map(e=>e.email)||[],source:"calendar",dateTime:new Date(e.start.dateTime||e.start.date)}))||[],o=await i.tasks.list({tasklist:"@default",dueMin:new Date(t).toISOString(),dueMax:new Date(r).toISOString(),showCompleted:!1}),n=o.data.items?.filter(e=>e.due).map(e=>({id:e.id,time:e.due,title:e.title,type:"Task",date:new Date(e.due).toISOString().slice(0,10),description:e.notes||"No description provided.",location:"",hangoutLink:"",attendees:[],source:"tasks",dateTime:new Date(e.due)}))||[];return[...a,...n].sort((e,t)=>e.dateTime.getTime()-t.dateTime.getTime())}catch(e){throw console.error("Error fetching calendar data:",e),Error("Failed to fetch calendar data")}}async function s(e){let t=new a.lkr.auth.OAuth2;t.setCredentials({access_token:e});let r=a.lkr.gmail({version:"v1",auth:t});try{let e=(await r.users.messages.list({userId:"me",q:"category:primary",maxResults:10})).data.messages;if(!e||0===e.length)return[];let t=e.map(async e=>{if(e.id){let{data:t}=await r.users.messages.get({userId:"me",id:e.id,format:"full"}),a=t.payload?.headers,o=a?.find(e=>"From"===e.name),s=a?.find(e=>"Subject"===e.name),i=a?.find(e=>"Date"===e.name),n=o&&o.value||"Unknown Sender",d=s&&s.value||"No Subject",l=t.snippet||"",c=i?new Date(i.value||0):new Date,p=function(e,t){let r=Math.floor((new Date().getTime()-e.getTime())/1e3),a=r/31536e3;return a>1?Math.floor(a)+" years ago":(a=r/2592e3)>1?Math.floor(a)+" months ago":(a=r/86400)>1?Math.floor(a)+" days ago":(a=r/3600)>1?Math.floor(a)+" hours ago":(a=r/60)>1?Math.floor(a)+" minutes ago":Math.floor(r)+" seconds ago"}(c,0),u="",m=e=>{if(!e)return"";let t=e.parts?.find(e=>"text/html"===e.mimeType);if(t&&t.body?.data)return Buffer.from(t.body.data,"base64").toString("utf-8");let r=e.parts?.find(e=>"text/plain"===e.mimeType);if(r&&r.body?.data)return Buffer.from(r.body.data,"base64").toString("utf-8");if(e.body?.data)return Buffer.from(e.body.data,"base64").toString("utf-8");if(e.parts)for(let t of e.parts){let e=m(t);if(e)return e}return""};return u=m(t.payload),{id:t.id,sender:n,subject:d,snippet:l,fullBody:u,timeAgo:p,isUnread:t.labelIds?.includes("UNREAD"),emailClient:"google"}}return null});return(await Promise.all(t)).filter(e=>null!==e)}catch(e){throw console.error("Error fetching emails:",e),Error("Failed to fetch emails")}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,972,647,816],()=>r(22312));module.exports=a})();